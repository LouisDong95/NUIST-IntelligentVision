
## **è¶…å¾®æœåŠ¡å™¨å¼€æœºå¡ Logo é—®é¢˜æŽ’æŸ¥ä¸Žè§£å†³æ–‡æ¡£**

### 1. é—®é¢˜çŽ°è±¡

* è®¾å¤‡ï¼šSupermicro ä¸»æ¿ + åŒ RTX 4090 + Ubuntu 22.04ï¼ˆç³»ç»Ÿå®‰è£…åœ¨ NVMe å›ºæ€ç¡¬ç›˜ä¸Šï¼‰
* æ–°å¢žç¡¬ä»¶ï¼šåœ¨ `/mnt` æŒ‚è½½ç›®å½•ä¸‹æ–°åŠ äº†ä¸€å—æœºæ¢°ç¡¬ç›˜ï¼ˆæ•°æ®ç›˜ï¼‰
* é—®é¢˜è¡¨çŽ°ï¼š

  1. å¼€æœºåœç•™åœ¨ **Supermicro + Ubuntu Logo** ç•Œé¢ï¼Œä¸è¿›å…¥å›¾å½¢ç™»å½•ç•Œé¢ï¼›
  2. ä½¿ç”¨ `Ctrl+Alt+F2` å¯è¿›å…¥ TTY æ–‡æœ¬ç»ˆç«¯ï¼Œå¹¶æ­£å¸¸ç™»å½•ç³»ç»Ÿï¼›
  3. NVIDIA é©±åŠ¨åŠ è½½æ­£å¸¸ï¼ˆ`nvidia-smi` å¯è¯†åˆ«ä¸¤å¼ æ˜¾å¡ï¼‰ï¼›
  4. ç³»ç»Ÿæ—¥å¿— `/var/log/Xorg.0.log` ä¸­å‡ºçŽ° `failed to load module "ast"` æŠ¥é”™ï¼›
  5. `gdm3` çŠ¶æ€ä¸º active(running)ï¼Œä½†å›¾å½¢ç•Œé¢æœªèƒ½å¯åŠ¨ã€‚

---

### 2. åŽŸå› åˆ†æž

#### 2.1 èƒŒæ™¯

* Supermicro ä¸»æ¿é€šå¸¸å†…ç½® **BMC ç®¡ç†èŠ¯ç‰‡ï¼ˆASPEED AST ç³»åˆ—ï¼‰** æä¾› VGA è¾“å‡ºã€‚
* å½“æ˜¾ç¤ºå™¨æŽ¥åœ¨ä¸»æ¿ VGA å£æ—¶ï¼ŒXorg å›¾å½¢æœåŠ¡å™¨ä¼šä¼˜å…ˆå°è¯•åŠ è½½ **`ast` é©±åŠ¨** æˆ– **modesetting é©±åŠ¨** æ¥é©±åŠ¨è¾“å‡ºã€‚
* NVIDIA é©±åŠ¨ä¸»è¦è´Ÿè´£ GPU åŠ é€Ÿä¸Ž CUDA è®¡ç®—ï¼Œä¸ç›´æŽ¥å‚ä¸Ž VGA è¾“å‡ºã€‚

#### 2.2 é—®é¢˜æ ¹æº

* ç³»ç»Ÿå¯åŠ¨æ—¶ï¼ŒXorg è¢«é…ç½®ä¸ºä¼˜å…ˆä½¿ç”¨ `ast` é©±åŠ¨è¾“å‡ºï¼Œä½†ç³»ç»Ÿä¸­ç¼ºå°‘ `xserver-xorg-video-ast` æ¨¡å—æ–‡ä»¶ï¼ˆæˆ–æ¨¡å—ä¸å¯ç”¨ï¼‰ï¼›
* å¯¼è‡´ Xorg å›¾å½¢æœåŠ¡å™¨åœ¨åˆå§‹åŒ–é˜¶æ®µæŠ¥é”™ï¼Œgdm3 è™½ç„¶è¿è¡Œï¼Œä½†å›¾å½¢ä¼šè¯æ— æ³•å»ºç«‹ â†’ åœç•™åœ¨ Logo ç•Œé¢ã€‚

#### 2.3 ä¸ºä»€ä¹ˆ NVIDIA é©±åŠ¨æ²¡æŠ¥é”™ï¼Ÿ

* `nvidia-smi` æ­£å¸¸æ˜¯å› ä¸º NVIDIA å†…æ ¸æ¨¡å—åŠ è½½æˆåŠŸï¼ŒCUDA è®¡ç®—å¯ç”¨ï¼›
* ä½† Xorg æ²¡æœ‰æŠŠæ˜¾ç¤ºç»‘å®šåˆ° NVIDIA è¾“å‡ºå£ï¼Œè€Œæ˜¯è¯•å›¾èµ°ä¸»æ¿ VGAï¼ˆASTï¼‰ï¼Œå› æ­¤ NVIDIA é©±åŠ¨çš„å›¾å½¢è¾“å‡ºåŠŸèƒ½æ²¡æœ‰è¢«è°ƒç”¨ã€‚

---

### 3. è§£å†³æ€è·¯

#### 3.1 æ€è·¯åˆ†æž

* **æ–¹æ¡ˆ 1ï¼ˆæŽ¨èï¼‰**ï¼šç›´æŽ¥è®© Xorg ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ **modesetting é©±åŠ¨** è¿›è¡Œ VGA è¾“å‡ºï¼ˆç»•è¿‡ `ast` æ¨¡å—ï¼‰ï¼Œé¿å…ç¼ºå¤±é©±åŠ¨åŒ…çš„ä¾èµ–é—®é¢˜ï¼ŒåŒæ—¶ä¿ç•™ NVIDIA é©±åŠ¨ä»…åšè®¡ç®—ã€‚
* **æ–¹æ¡ˆ 2**ï¼šå®‰è£… `xserver-xorg-video-ast` åŒ…ï¼Œè®© Xorg ç»§ç»­ä½¿ç”¨ AST ä¸“ç”¨é©±åŠ¨ã€‚

#### 3.2 é€‰æ‹©ç†ç”±

* modesetting æ˜¯ Xorg çš„é€šç”¨è¾“å‡ºé©±åŠ¨ï¼Œä¾èµ–æžå°‘ï¼Œä¸Žå†…æ ¸ DRM æ¨¡å—åä½œç¨³å®šï¼›
* NVIDIA é©±åŠ¨ä¸Ž modesetting é©±åŠ¨å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œäº’ä¸å¹²æ‰°ï¼šæ¡Œé¢èµ° VGA/modesettingï¼Œè®¡ç®—èµ° GPUã€‚

---

### 4. è§£å†³æ­¥éª¤ï¼ˆæ–¹æ¡ˆä¸€ï¼‰

#### 4.1 ç¦ç”¨ Wayland

```bash
sudo sed -i 's/^#WaylandEnable=false/WaylandEnable=false/' /etc/gdm3/custom.conf
```

#### 4.2 åˆ›å»º Xorg é…ç½®æ–‡ä»¶ï¼Œå¼ºåˆ¶ä½¿ç”¨ modesetting

```bash
sudo mkdir -p /etc/X11/xorg.conf.d
sudo tee /etc/X11/xorg.conf.d/10-vga-modesetting.conf >/dev/null <<'EOF'
Section "Device"
    Identifier "Builtin VGA via modesetting"
    Driver "modesetting"
EndSection
EOF
```

#### 4.3 ç§»é™¤å¯èƒ½å¹²æ‰°çš„æ—§ Xorg é…ç½®

```bash
sudo [ -f /etc/X11/xorg.conf ] && sudo mv /etc/X11/xorg.conf /etc/X11/xorg.conf.bak
```

#### 4.4 ç¡®è®¤ aspeed DRM æ¨¡å—å·²åŠ è½½ï¼ˆéžå¿…é¡»ï¼‰

```bash
lsmod | grep aspeed || sudo modprobe aspeed
```

#### 4.5 é‡å¯æ˜¾ç¤ºç®¡ç†å™¨

```bash
sudo systemctl restart gdm3
```

æŒ‰ `Ctrl+Alt+F1`ï¼ˆæˆ– `Ctrl+Alt+F7`ï¼‰è¿”å›žå›¾å½¢ç•Œé¢ï¼Œç¡®è®¤æ˜¯å¦æ¢å¤ã€‚

---

### 5. éªŒè¯ç»“æžœ

* å›¾å½¢ç™»å½•ç•Œé¢æˆåŠŸæ˜¾ç¤ºï¼›
* `nvidia-smi` ä»èƒ½æ­£å¸¸è¯†åˆ«åŒ 4090ï¼ŒCUDA è®¡ç®—åŠŸèƒ½ä¸å—å½±å“ï¼›
* `/var/log/Xorg.0.log` ä¸­å·²æ—  `failed to load module ast` æŠ¥é”™ï¼›
* ç³»ç»Ÿé‡å¯åŽå›¾å½¢ç•Œé¢å¯æ­£å¸¸è¿›å…¥ï¼Œé—®é¢˜å½»åº•è§£å†³ã€‚

---

### 6. ç»éªŒæ€»ç»“

1. **æœåŠ¡å™¨ VGA è¾“å‡ºä¸ç­‰äºŽ NVIDIA è¾“å‡º**
   ä¸»æ¿ VGA å£é€šå¸¸ç”± BMC/AST é©±åŠ¨ï¼Œä¸ç»è¿‡ GPU è¾“å‡ºé€šé“ã€‚
2. **é©±åŠ¨ç¼ºå¤±ä¼šå¯¼è‡´ Xorg å¯åŠ¨å¤±è´¥**
   å³ä¾¿ gdm3 çŠ¶æ€æ­£å¸¸ï¼ŒXorg è‹¥æ‰¾ä¸åˆ°å¯¹åº”æ˜¾ç¤ºé©±åŠ¨æ¨¡å—ï¼Œä»ä¼šå¡åœ¨ Logoã€‚
3. **åˆ†ç¦»æ˜¾ç¤ºä¸Žè®¡ç®—æ˜¯ç¨³å¦¥æ–¹æ¡ˆ**
   è®©æ¡Œé¢èµ° modesettingï¼ŒGPU ä¸“æ³¨ CUDAï¼Œå¯ä»¥é¿å…é©±åŠ¨å†²çªï¼Œå°¤å…¶åœ¨æœåŠ¡å™¨/è¿œç¨‹ç®¡ç†åœºæ™¯ã€‚
4. **TTY æ˜¯æŽ’éšœåˆ©å™¨**
   åœ¨ Logo å¡ä½æ—¶ï¼Œ`Ctrl+Alt+F2` è¿›å…¥ TTYï¼Œå¯ä»¥æŸ¥æ—¥å¿—ã€æ”¹é…ç½®ã€é‡å¯æœåŠ¡ã€‚

------
è§£å†³æ–¹æ¡ˆæœ¬è´¨ä¸Šå°±æ˜¯**ç»•è¿‡æŸå/ç¼ºå¤±çš„ AST ä¸“ç”¨é©±åŠ¨ï¼Œæ”¹ç”¨é€šç”¨çš„ modesetting é©±åŠ¨æ¥å¯åŠ¨ Xorg**ã€‚

å…·ä½“æ¥è¯´ï¼š

* **åŽŸæƒ…å†µ**

  * Supermicro ä¸»æ¿ä¸Šçš„ VGA æŽ¥å£èµ°çš„æ˜¯ ASPEED AST BMC èŠ¯ç‰‡ã€‚
  * Ubuntu çš„ Xorg é»˜è®¤ä¼šå°è¯•åŠ è½½ `ast` æ¨¡å—ï¼ˆ`xserver-xorg-video-ast` æä¾›ï¼‰ã€‚
  * è¿™ä¸ªæ¨¡å—åœ¨ç³»ç»Ÿä¸­è¦ä¹ˆç¼ºå¤±ã€è¦ä¹ˆç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå¯¼è‡´ GDM3 åœ¨å¯åŠ¨æ—¶åŠ è½½å¤±è´¥ï¼ˆ`failed to load module "ast"`ï¼‰ï¼Œç»“æžœåœåœ¨ Logo ç•Œé¢ã€‚

* **é‡‡å–çš„æ–¹æ¡ˆ**

  1. ç¼–è¾‘ Xorg é…ç½®æ–‡ä»¶ï¼ˆæˆ–æ·»åŠ æ–°çš„é…ç½®ï¼‰ï¼ŒæŒ‡å®š**ä¸å†ä½¿ç”¨ `ast` é©±åŠ¨**ï¼Œè€Œæ˜¯ç”¨å†…ç½®çš„**modesetting**é©±åŠ¨ï¼š

     ```bash
     sudo nano /etc/X11/xorg.conf.d/10-vga.conf
     ```

     å†…å®¹ï¼š

     ```conf
     Section "Device"
         Identifier "Builtin VGA"
         Driver "modesetting"
     EndSection
     ```
  2. ä¿å­˜å¹¶é‡å¯ã€‚
  3. modesetting é©±åŠ¨ç”± Xorg è‡ªå¸¦ï¼Œä¸ä¾èµ–å¤–éƒ¨ AST é©±åŠ¨ï¼Œå› æ­¤æˆåŠŸå¯åŠ¨äº†å›¾å½¢ç•Œé¢ã€‚

* **æ•ˆæžœ**

  * å›¾å½¢ç•Œé¢æ­£å¸¸å¯åŠ¨ï¼ŒGDM3 ç™»å½•å¯ç”¨ã€‚
  * ç»•è¿‡äº† AST é©±åŠ¨åŠ è½½è¿‡ç¨‹ï¼Œä»Žè€Œé¿å…å¡æ­»ã€‚

ðŸ“Œ **æ€»ç»“**
è¿™æ˜¯å…¸åž‹çš„â€œé©±åŠ¨åŠ è½½å¤±è´¥ â†’ å›¾å½¢ç•Œé¢å¡æ­»â€é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯**ç”¨ç¨³å®šçš„é€šç”¨é©±åŠ¨æ›¿ä»£ä¸“ç”¨é©±åŠ¨**ï¼Œå±žäºŽç»•è¿‡è€Œä¸æ˜¯ä¿®å¤ AST é©±åŠ¨æœ¬èº«ã€‚
å¦‚æžœå°†æ¥éœ€è¦ VGA è¾“å‡ºçš„å®Œæ•´ç¡¬ä»¶åŠ é€ŸåŠŸèƒ½ï¼Œå¯èƒ½è¿˜éœ€è¦é‡æ–°å®‰è£…æˆ–æ›´æ–° `xserver-xorg-video-ast` åŒ…ï¼Œä½†åœ¨æœåŠ¡å™¨åœºæ™¯ä¸‹ï¼ˆå¤§æ¦‚çŽ‡ç”¨ 4090 åšè®¡ç®—ï¼Œä¸ä¾èµ– VGA æ€§èƒ½ï¼‰ï¼Œmodesetting å·²ç»è¶³å¤Ÿç¨³å®šã€‚
